{"version":3,"sources":["../src/index.ts","../src/components/bhd.tsx","../src/utils/context.ts","../src/components/contentBlock.tsx","../src/components/context.tsx","../src/utils/url.ts","../src/utils/index.ts"],"sourcesContent":["export * from \"./components/index\";\nexport * from \"./utils/index\";\nexport * from \"./models/index\";\nexport * from \"./types\";\n","import { FC, forwardRef, useEffect, useState } from \"react\";\nimport { useBhdInternalContext } from \"../utils/context\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { BhdContentBlockComponent } from \"./contentBlock\";\n\nexport type BhdComponentProps = {\n  contentBlockId: string;\n};\n\nexport const BhdComponent: FC<BhdComponentProps> = forwardRef<\n  HTMLElement,\n  BhdComponentProps\n>(({ contentBlockId, ...rest }, ref) => {\n  const context = useBhdInternalContext();\n\n  const [contentBlock, setContentBlock] = useState<\n    | {\n        state: \"loading\";\n      }\n    | { state: \"loaded\"; data: BhdContentBlockWithBlueprint }\n    | { state: \"failed\"; reason: string }\n  >({ state: \"loading\" });\n\n  useEffect(() => {\n    context\n      .getContentBlock(contentBlockId)\n      .then((contentBlock) =>\n        setContentBlock({ state: \"loaded\", data: contentBlock }),\n      )\n      .catch((error) =>\n        setContentBlock({ state: \"failed\", reason: \"\" + error }),\n      );\n  }, [contentBlockId, context]);\n\n  if (contentBlock.state === \"loading\") {\n    return <context.loadingComponent />;\n  }\n\n  if (contentBlock.state === \"failed\") {\n    // TODO: custom error component\n    return <div>Error: {contentBlock.reason}</div>;\n  }\n\n  return (\n    <BhdContentBlockComponent\n      ref={ref}\n      contentBlock={contentBlock.data}\n      {...rest}\n    />\n  );\n});\n","import { AxiosInstance } from \"axios\";\nimport { createContext, ElementType, useContext } from \"react\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { BhdBlueprintLut } from \"../types\";\n\nexport type BhdContextType = {\n  accessToken: string;\n  blueprintLut: BhdBlueprintLut;\n  getContentBlock: (id: string) => Promise<BhdContentBlockWithBlueprint>;\n};\n\nexport type BhdInternalContextType = BhdContextType & {\n  axiosInstance: AxiosInstance;\n\n  getBlueprintComponent: (id: string) => BhdBlueprintLut[keyof BhdBlueprintLut];\n\n  getContentBlock: (id: string) => Promise<BhdContentBlockWithBlueprint>;\n\n  loadingComponent: ElementType;\n};\n\nexport const BhdInternalContext = createContext<BhdInternalContextType>(\n  {} as BhdInternalContextType,\n);\n\nexport const useBhdInternalContext = () => useContext(BhdInternalContext);\n","import { forwardRef } from \"react\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { useBhdInternalContext } from \"../utils/context\";\n\nexport type BhdContentBlockInternalComponentProps = {\n  contentBlock: BhdContentBlockWithBlueprint;\n};\n\nexport const BhdContentBlockComponent = forwardRef<\n  HTMLElement,\n  BhdContentBlockInternalComponentProps\n>(({ contentBlock, ...rest }, ref) => {\n  const context = useBhdInternalContext();\n\n  const Component = context.getBlueprintComponent(\n    contentBlock.contentBlockBlueprintId,\n  );\n\n  if (Component) {\n    return (\n      <Component\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-expect-error\n        ref={ref}\n        loadingComponent={context.loadingComponent}\n        contentBlock={contentBlock}\n        {...rest}\n      />\n    );\n  }\n\n  return (\n    <p>\n      No component was registered for the blueprint{\" \"}\n      <strong>{contentBlock.contentBlockBlueprint.name}</strong> (ID:{\" \"}\n      {contentBlock.contentBlockBlueprintId}).\n    </p>\n  );\n});\n","import { ElementType, FC, PropsWithChildren, useState } from \"react\";\nimport { BhdInternalContext, BhdInternalContextType } from \"../utils/context\";\nimport axios from \"axios\";\nimport { DEFAULT_BASE_URL } from \"../utils/url\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { BhdBlueprintLut } from \"../types\";\n\nexport type BhdContextOptions = {\n  accessToken: string;\n  baseUrl?: string;\n  blueprintLut: BhdBlueprintLut;\n  loadingComponent?: ElementType;\n};\n\nexport const BhdContext: FC<\n  PropsWithChildren<{ options: BhdContextOptions }>\n> = ({ children, options }) => {\n  const [context] = useState<BhdInternalContextType>(() => {\n    const axiosInstance = axios.create({\n      baseURL: new URL(\"api\", options.baseUrl ?? DEFAULT_BASE_URL).href,\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    });\n\n    axiosInstance.interceptors.request.use((config) => {\n      config.headers.Authorization = `Bearer ${context.accessToken}`;\n      return config;\n    });\n\n    return {\n      axiosInstance,\n      getContentBlock: (id: string): Promise<BhdContentBlockWithBlueprint> =>\n        context.axiosInstance\n          .get<{ block: BhdContentBlockWithBlueprint }>(`/block/${id}`)\n          .then((res) => res.data.block),\n      getBlueprintComponent: (\n        id: string,\n      ): BhdBlueprintLut[keyof BhdBlueprintLut] => context.blueprintLut[id],\n      loadingComponent: options.loadingComponent ?? (() => <p>Loading...</p>),\n      ...options,\n    };\n  });\n\n  return (\n    <BhdInternalContext.Provider value={context}>\n      {children}\n    </BhdInternalContext.Provider>\n  );\n};\n","export const DEFAULT_BASE_URL = \"https://bhd.matteolutz.de\";\n","import { BhdContextType, useBhdInternalContext } from \"./context\";\n\nexport { type BhdContextType } from \"./context\";\n\nexport const useBhdContext = (): BhdContextType => {\n  const internalContext = useBhdInternalContext();\n\n  return {\n    accessToken: internalContext.accessToken,\n    blueprintLut: internalContext.blueprintLut,\n    getContentBlock: internalContext.getContentBlock,\n  };\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAA,IAAAA,gBAAoD;;;ACCpD,mBAAuD;AAoBhD,IAAM,yBAAqB;AAAA,EAChC,CAAC;AACH;AAEO,IAAM,wBAAwB,UAAM,yBAAW,kBAAkB;;;ACzBxE,IAAAC,gBAA2B;AAoBrB;AAZC,IAAM,+BAA2B,0BAGtC,CAAC,EAAE,cAAc,GAAG,KAAK,GAAG,QAAQ;AACpC,QAAM,UAAU,sBAAsB;AAEtC,QAAM,YAAY,QAAQ;AAAA,IACxB,aAAa;AAAA,EACf;AAEA,MAAI,WAAW;AACb,WACE;AAAA,MAAC;AAAA;AAAA,QAGC;AAAA,QACA,kBAAkB,QAAQ;AAAA,QAC1B;AAAA,QACC,GAAG;AAAA;AAAA,IACN;AAAA,EAEJ;AAEA,SACE,6CAAC,OAAE;AAAA;AAAA,IAC6C;AAAA,IAC9C,4CAAC,YAAQ,uBAAa,sBAAsB,MAAK;AAAA,IAAS;AAAA,IAAM;AAAA,IAC/D,aAAa;AAAA,IAAwB;AAAA,KACxC;AAEJ,CAAC;;;AFHU,IAAAC,sBAAA;AA1BJ,IAAM,mBAAsC,0BAGjD,CAAC,EAAE,gBAAgB,GAAG,KAAK,GAAG,QAAQ;AACtC,QAAM,UAAU,sBAAsB;AAEtC,QAAM,CAAC,cAAc,eAAe,QAAI,wBAMtC,EAAE,OAAO,UAAU,CAAC;AAEtB,+BAAU,MAAM;AACd,YACG,gBAAgB,cAAc,EAC9B;AAAA,MAAK,CAACC,kBACL,gBAAgB,EAAE,OAAO,UAAU,MAAMA,cAAa,CAAC;AAAA,IACzD,EACC;AAAA,MAAM,CAAC,UACN,gBAAgB,EAAE,OAAO,UAAU,QAAQ,KAAK,MAAM,CAAC;AAAA,IACzD;AAAA,EACJ,GAAG,CAAC,gBAAgB,OAAO,CAAC;AAE5B,MAAI,aAAa,UAAU,WAAW;AACpC,WAAO,6CAAC,QAAQ,kBAAR,EAAyB;AAAA,EACnC;AAEA,MAAI,aAAa,UAAU,UAAU;AAEnC,WAAO,8CAAC,SAAI;AAAA;AAAA,MAAQ,aAAa;AAAA,OAAO;AAAA,EAC1C;AAEA,SACE;AAAA,IAAC;AAAA;AAAA,MACC;AAAA,MACA,cAAc,aAAa;AAAA,MAC1B,GAAG;AAAA;AAAA,EACN;AAEJ,CAAC;;;AGlDD,IAAAC,gBAA6D;AAE7D,mBAAkB;;;ACFX,IAAM,mBAAmB;;;ADuC2B,IAAAC,sBAAA;AAzBpD,IAAM,aAET,CAAC,EAAE,UAAU,QAAQ,MAAM;AAC7B,QAAM,CAAC,OAAO,QAAI,wBAAiC,MAAM;AACvD,UAAM,gBAAgB,aAAAC,QAAM,OAAO;AAAA,MACjC,SAAS,IAAI,IAAI,OAAO,QAAQ,WAAW,gBAAgB,EAAE;AAAA,MAC7D,SAAS;AAAA,QACP,gBAAgB;AAAA,MAClB;AAAA,IACF,CAAC;AAED,kBAAc,aAAa,QAAQ,IAAI,CAAC,WAAW;AACjD,aAAO,QAAQ,gBAAgB,UAAU,QAAQ,WAAW;AAC5D,aAAO;AAAA,IACT,CAAC;AAED,WAAO;AAAA,MACL;AAAA,MACA,iBAAiB,CAAC,OAChB,QAAQ,cACL,IAA6C,UAAU,EAAE,EAAE,EAC3D,KAAK,CAAC,QAAQ,IAAI,KAAK,KAAK;AAAA,MACjC,uBAAuB,CACrB,OAC2C,QAAQ,aAAa,EAAE;AAAA,MACpE,kBAAkB,QAAQ,qBAAqB,MAAM,6CAAC,OAAE,wBAAU;AAAA,MAClE,GAAG;AAAA,IACL;AAAA,EACF,CAAC;AAED,SACE,6CAAC,mBAAmB,UAAnB,EAA4B,OAAO,SACjC,UACH;AAEJ;;;AE7CO,IAAM,gBAAgB,MAAsB;AACjD,QAAM,kBAAkB,sBAAsB;AAE9C,SAAO;AAAA,IACL,aAAa,gBAAgB;AAAA,IAC7B,cAAc,gBAAgB;AAAA,IAC9B,iBAAiB,gBAAgB;AAAA,EACnC;AACF;","names":["import_react","import_react","import_jsx_runtime","contentBlock","import_react","import_jsx_runtime","axios"]}