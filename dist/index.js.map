{"version":3,"sources":["../src/components/bhd.tsx","../src/utils/context.ts","../src/components/contentBlock.tsx","../src/components/inline.tsx","../src/components/context.tsx","../src/utils/url.ts","../src/utils/index.ts"],"sourcesContent":["import { FC, forwardRef, HTMLProps, useEffect, useState } from \"react\";\nimport { useBhdInternalContext } from \"../utils/context\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { BhdContentBlockComponent } from \"./contentBlock\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type BhdComponentProps<T extends object = any> = {\n  contentBlockId: string;\n  options?: T;\n};\n\nexport const BhdComponent: FC<BhdComponentProps> = forwardRef<\n  HTMLElement,\n  BhdComponentProps & HTMLProps<HTMLElement>\n>(({ contentBlockId, options, ...rest }, ref) => {\n  const context = useBhdInternalContext();\n\n  const [contentBlock, setContentBlock] = useState<\n    | {\n        state: \"loading\";\n      }\n    | { state: \"loaded\"; data: BhdContentBlockWithBlueprint }\n    | { state: \"failed\"; reason: string }\n  >({ state: \"loading\" });\n\n  useEffect(() => {\n    setContentBlock({ state: \"loading\" });\n\n    context\n      .getContentBlock(contentBlockId)\n      .then((contentBlock) =>\n        setContentBlock({ state: \"loaded\", data: contentBlock }),\n      )\n      .catch((error) =>\n        setContentBlock({ state: \"failed\", reason: \"\" + error }),\n      );\n  }, [contentBlockId, context]);\n\n  if (contentBlock.state === \"loading\") {\n    return <context.loadingComponent {...rest} />;\n  }\n\n  if (contentBlock.state === \"failed\") {\n    // TODO: custom error component\n    return <div {...rest}>Error: {contentBlock.reason}</div>;\n  }\n\n  return (\n    <BhdContentBlockComponent\n      ref={ref}\n      contentBlock={contentBlock.data}\n      options={options}\n      {...rest}\n    />\n  );\n});\n","import { AxiosInstance } from \"axios\";\nimport { createContext, ElementType, useContext } from \"react\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { BhdBlueprintLut } from \"../types\";\n\nexport type BhdContextType = {\n  accessToken: string;\n  blueprintLut: BhdBlueprintLut;\n  getContentBlock: (id: string) => Promise<BhdContentBlockWithBlueprint>;\n  getAssetUrl: (assetId: string) => string;\n};\n\nexport type BhdInternalContextType = BhdContextType & {\n  axiosInstance: AxiosInstance;\n\n  getBlueprintComponent: (id: string) => BhdBlueprintLut[keyof BhdBlueprintLut];\n\n  onFieldClick: (blockId: string, fieldName: string) => void;\n\n  loadingComponent: ElementType;\n\n  liveEditEnabled: boolean;\n};\n\nexport const BhdInternalContext = createContext<BhdInternalContextType>(\n  {} as BhdInternalContextType,\n);\n\nexport const useBhdInternalContext = () => useContext(BhdInternalContext);\n","import { ComponentProps, ElementType, FC, forwardRef, HTMLProps } from \"react\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { useBhdInternalContext } from \"../utils/context\";\nimport {\n  BhdContentBlockComponentFieldProps,\n  BhdContentBlockComponentProps,\n  BhdContentBlockComponentRootProps,\n} from \"../types\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type BhdContentBlockInternalComponentProps<T extends object = any> = {\n  contentBlock: BhdContentBlockWithBlueprint;\n  options: T;\n  inlineComponent?: FC<BhdContentBlockComponentProps<T>>;\n};\n\nexport const BhdContentBlockComponent = forwardRef<\n  HTMLElement,\n  BhdContentBlockInternalComponentProps & HTMLProps<HTMLElement>\n>(({ contentBlock, inlineComponent, options, ...rest }, ref) => {\n  const context = useBhdInternalContext();\n\n  const Component =\n    inlineComponent ??\n    context.getBlueprintComponent(contentBlock.contentBlockBlueprintId);\n\n  const bhdField = <T extends ElementType, P = ComponentProps<T>>(\n    fieldName: string,\n    props: P,\n  ): BhdContentBlockComponentFieldProps & P => ({\n    ...props,\n    \"data-bhd-field-name\": fieldName,\n    ...(context.liveEditEnabled\n      ? {\n          onClick: (e) => {\n            e.stopPropagation();\n            console.log(\n              \"field click\",\n              contentBlock.id,\n              fieldName,\n              \"on element\",\n              e.target,\n            );\n            context.onFieldClick(contentBlock.id, fieldName);\n\n            if (\n              props &&\n              typeof props === \"object\" &&\n              \"onClick\" in props &&\n              typeof props.onClick === \"function\"\n            )\n              props.onClick(e);\n          },\n        }\n      : {}),\n  });\n\n  const bhdRoot = <T extends ElementType, P = ComponentProps<T>>(\n    props: P,\n  ): BhdContentBlockComponentRootProps & P => ({\n    ...props,\n    \"data-bhd-block-id\": contentBlock.id,\n    ...(\"data-bhd-field-name\" in rest\n      ? {\n          \"data-bhd-block-parent-field-name\": rest[\n            \"data-bhd-field-name\"\n          ] as string,\n        }\n      : {}),\n  });\n\n  if (Component) {\n    return (\n      <Component\n        ref={ref}\n        loadingComponent={context.loadingComponent}\n        contentBlock={contentBlock}\n        bhdField={bhdField}\n        bhdRoot={bhdRoot}\n        options={options}\n        {...rest}\n      />\n    );\n  }\n\n  return (\n    <p {...bhdRoot<\"p\">({})}>\n      No component was registered for the blueprint{\" \"}\n      <strong>{contentBlock.contentBlockBlueprint.name}</strong> (ID:{\" \"}\n      {contentBlock.contentBlockBlueprintId}).\n    </p>\n  );\n});\n","import { FC, forwardRef, HTMLProps, useEffect, useState } from \"react\";\nimport { BhdContentBlockComponentProps } from \"../types\";\nimport { BhdComponentProps } from \"./bhd\";\nimport { useBhdInternalContext } from \"../utils/context\";\nimport { BhdContentBlockWithBlueprint } from \"../models\";\nimport { BhdContentBlockComponent } from \"./contentBlock\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type BhdInlineComponentProps<T extends object = any> =\n  BhdComponentProps<T> & {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    children: FC<BhdContentBlockComponentProps<any>>;\n  };\n\nexport const BhdInlineComponent = forwardRef<\n  HTMLElement,\n  BhdInlineComponentProps & Omit<HTMLProps<HTMLElement>, \"children\">\n>(({ contentBlockId, children, options, ...rest }, ref) => {\n  const context = useBhdInternalContext();\n\n  const [contentBlock, setContentBlock] = useState<\n    | {\n        state: \"loading\";\n      }\n    | { state: \"loaded\"; data: BhdContentBlockWithBlueprint }\n    | { state: \"failed\"; reason: string }\n  >({ state: \"loading\" });\n\n  useEffect(() => {\n    setContentBlock({ state: \"loading\" });\n\n    context\n      .getContentBlock(contentBlockId)\n      .then((contentBlock) =>\n        setContentBlock({ state: \"loaded\", data: contentBlock }),\n      )\n      .catch((error) =>\n        setContentBlock({ state: \"failed\", reason: \"\" + error }),\n      );\n  }, [contentBlockId, context]);\n\n  if (contentBlock.state === \"loading\") {\n    return <context.loadingComponent {...rest} />;\n  }\n\n  if (contentBlock.state === \"failed\") {\n    // TODO: custom error component\n    return <div {...rest}>Error: {contentBlock.reason}</div>;\n  }\n\n  return (\n    <BhdContentBlockComponent\n      inlineComponent={children}\n      ref={ref}\n      contentBlock={contentBlock.data}\n      options={options}\n      {...rest}\n    />\n  );\n});\n","import { ElementType, FC, PropsWithChildren, useEffect, useState } from \"react\";\nimport { BhdInternalContext, BhdInternalContextType } from \"../utils/context\";\nimport axios from \"axios\";\nimport { DEFAULT_BASE_URL } from \"../utils/url\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { BhdBlueprintLut } from \"../types\";\n\nexport type BhdContextOptions = {\n  accessToken: string;\n  baseUrl?: string;\n  blueprintLut: BhdBlueprintLut;\n  loadingComponent?: ElementType;\n};\n\nexport const BhdContext: FC<\n  PropsWithChildren<{ options: BhdContextOptions }>\n> = ({ children, options }) => {\n  const [context, setContext] = useState<BhdInternalContextType>(() => {\n    const axiosInstance = axios.create({\n      baseURL: new URL(\"api\", options.baseUrl ?? DEFAULT_BASE_URL).href,\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    });\n\n    axiosInstance.interceptors.request.use((config) => {\n      config.headers.Authorization = `Bearer ${context.accessToken}`;\n      return config;\n    });\n\n    return {\n      axiosInstance,\n      getAssetUrl: (assetId: string): string =>\n        new URL(\n          `api/asset/${assetId}?accessToken=${context.accessToken}`,\n          options.baseUrl ?? DEFAULT_BASE_URL,\n        ).href,\n      getContentBlock: (id: string): Promise<BhdContentBlockWithBlueprint> =>\n        context.axiosInstance\n          .get<{ block: BhdContentBlockWithBlueprint }>(`/block/${id}`)\n          .then((res) => res.data.block),\n      getBlueprintComponent: (\n        id: string,\n      ): BhdBlueprintLut[keyof BhdBlueprintLut] => context.blueprintLut[id],\n      loadingComponent: options.loadingComponent ?? (() => <p>Loading...</p>),\n      liveEditEnabled: false,\n      onFieldClick: (blockId: string, fieldName: string) => {\n        window.top?.postMessage(\n          {\n            bhd: true,\n            type: \"bhd-live-edit-field-click\",\n            field: { blockId, fieldName },\n          },\n          \"*\",\n        );\n      },\n      ...options,\n    };\n  });\n\n  useEffect(() => {\n    if (context.liveEditEnabled) document.body.dataset.bhdLiveEdit = \"enabled\";\n    else document.body.dataset.bhdLiveEdit = \"disabled\";\n  }, [context.liveEditEnabled]);\n\n  useEffect(() => {\n    window.top?.postMessage({ bhd: true, type: \"bhd-ready\" }, \"*\");\n\n    window.addEventListener(\"message\", (e) => {\n      if (!(\"bhd\" in e.data)) return;\n\n      switch (e.data.type) {\n        case \"bhd-live-edit\":\n          setContext((prev) => ({ ...prev, liveEditEnabled: true }));\n          break;\n        case \"bhd-live-edit-reload\": {\n          setContext((prev) => ({ ...prev }));\n          break;\n        }\n      }\n    });\n  }, []);\n\n  return (\n    <BhdInternalContext.Provider value={context}>\n      {children}\n    </BhdInternalContext.Provider>\n  );\n};\n","export const DEFAULT_BASE_URL = \"https://bhd.matteolutz.de\";\n","import { BhdContextType, useBhdInternalContext } from \"./context\";\n\nexport { type BhdContextType } from \"./context\";\n\nexport const useBhdContext = (): BhdContextType => {\n  const internalContext = useBhdInternalContext();\n\n  return {\n    accessToken: internalContext.accessToken,\n    blueprintLut: internalContext.blueprintLut,\n    getContentBlock: internalContext.getContentBlock,\n    getAssetUrl: internalContext.getAssetUrl,\n  };\n};\n"],"mappings":"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","names":["forwardRef","jsx","jsxs","forwardRef","contentBlock","forwardRef","useEffect","useState","jsx","jsxs","forwardRef","useState","useEffect","contentBlock","useEffect","useState","jsx","useState","useEffect"]}