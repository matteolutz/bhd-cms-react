{"version":3,"sources":["../src/components/bhd.tsx","../src/utils/context.ts","../src/components/contentBlock.tsx","../src/components/context.tsx","../src/utils/url.ts","../src/utils/index.ts"],"sourcesContent":["import { FC, forwardRef, useEffect, useState } from \"react\";\nimport { useBhdInternalContext } from \"../utils/context\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { BhdContentBlockComponent } from \"./contentBlock\";\n\nexport type BhdComponentProps = {\n  contentBlockId: string;\n};\n\nexport const BhdComponent: FC<BhdComponentProps> = forwardRef<\n  HTMLElement,\n  BhdComponentProps\n>(({ contentBlockId, ...rest }, ref) => {\n  const context = useBhdInternalContext();\n\n  const [contentBlock, setContentBlock] = useState<\n    | {\n        state: \"loading\";\n      }\n    | { state: \"loaded\"; data: BhdContentBlockWithBlueprint }\n    | { state: \"failed\"; reason: string }\n  >({ state: \"loading\" });\n\n  useEffect(() => {\n    context\n      .getContentBlock(contentBlockId)\n      .then((contentBlock) =>\n        setContentBlock({ state: \"loaded\", data: contentBlock }),\n      )\n      .catch((error) =>\n        setContentBlock({ state: \"failed\", reason: \"\" + error }),\n      );\n  }, [contentBlockId, context]);\n\n  if (contentBlock.state === \"loading\") {\n    return <context.loadingComponent />;\n  }\n\n  if (contentBlock.state === \"failed\") {\n    // TODO: custom error component\n    return <div>Error: {contentBlock.reason}</div>;\n  }\n\n  return (\n    <BhdContentBlockComponent\n      ref={ref}\n      contentBlock={contentBlock.data}\n      {...rest}\n    />\n  );\n});\n","import { AxiosInstance } from \"axios\";\nimport { createContext, ElementType, useContext } from \"react\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { BhdBlueprintLut } from \"../types\";\n\nexport type BhdContextType = {\n  accessToken: string;\n  blueprintLut: BhdBlueprintLut;\n  getContentBlock: (id: string) => Promise<BhdContentBlockWithBlueprint>;\n  getAssetUrl: (assetId: string) => string;\n};\n\nexport type BhdInternalContextType = BhdContextType & {\n  axiosInstance: AxiosInstance;\n\n  getBlueprintComponent: (id: string) => BhdBlueprintLut[keyof BhdBlueprintLut];\n\n  loadingComponent: ElementType;\n};\n\nexport const BhdInternalContext = createContext<BhdInternalContextType>(\n  {} as BhdInternalContextType,\n);\n\nexport const useBhdInternalContext = () => useContext(BhdInternalContext);\n","import { forwardRef } from \"react\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { useBhdInternalContext } from \"../utils/context\";\n\nexport type BhdContentBlockInternalComponentProps = {\n  contentBlock: BhdContentBlockWithBlueprint;\n};\n\nexport const BhdContentBlockComponent = forwardRef<\n  HTMLElement,\n  BhdContentBlockInternalComponentProps\n>(({ contentBlock, ...rest }, ref) => {\n  const context = useBhdInternalContext();\n\n  const Component = context.getBlueprintComponent(\n    contentBlock.contentBlockBlueprintId,\n  );\n\n  if (Component) {\n    return (\n      <Component\n        ref={ref}\n        loadingComponent={context.loadingComponent}\n        contentBlock={contentBlock}\n        bhdField={(fieldName: string) => ({\n          \"data-bhd-field-name\": fieldName,\n        })}\n        bhdRoot={() => ({\n          \"data-bhd-block-id\": contentBlock.id,\n        })}\n        {...rest}\n      />\n    );\n  }\n\n  return (\n    <p>\n      No component was registered for the blueprint{\" \"}\n      <strong>{contentBlock.contentBlockBlueprint.name}</strong> (ID:{\" \"}\n      {contentBlock.contentBlockBlueprintId}).\n    </p>\n  );\n});\n","import { ElementType, FC, PropsWithChildren, useState } from \"react\";\nimport { BhdInternalContext, BhdInternalContextType } from \"../utils/context\";\nimport axios from \"axios\";\nimport { DEFAULT_BASE_URL } from \"../utils/url\";\nimport { BhdContentBlockWithBlueprint } from \"../models/contentBlock\";\nimport { BhdBlueprintLut } from \"../types\";\n\nexport type BhdContextOptions = {\n  accessToken: string;\n  baseUrl?: string;\n  blueprintLut: BhdBlueprintLut;\n  loadingComponent?: ElementType;\n};\n\nexport const BhdContext: FC<\n  PropsWithChildren<{ options: BhdContextOptions }>\n> = ({ children, options }) => {\n  const [context] = useState<BhdInternalContextType>(() => {\n    const axiosInstance = axios.create({\n      baseURL: new URL(\"api\", options.baseUrl ?? DEFAULT_BASE_URL).href,\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    });\n\n    axiosInstance.interceptors.request.use((config) => {\n      config.headers.Authorization = `Bearer ${context.accessToken}`;\n      return config;\n    });\n\n    return {\n      axiosInstance,\n      getAssetUrl: (assetId: string): string =>\n        new URL(\n          `api/asset/${assetId}?accessToken=${context.accessToken}`,\n          options.baseUrl ?? DEFAULT_BASE_URL,\n        ).href,\n      getContentBlock: (id: string): Promise<BhdContentBlockWithBlueprint> =>\n        context.axiosInstance\n          .get<{ block: BhdContentBlockWithBlueprint }>(`/block/${id}`)\n          .then((res) => res.data.block),\n      getBlueprintComponent: (\n        id: string,\n      ): BhdBlueprintLut[keyof BhdBlueprintLut] => context.blueprintLut[id],\n      loadingComponent: options.loadingComponent ?? (() => <p>Loading...</p>),\n      ...options,\n    };\n  });\n\n  return (\n    <BhdInternalContext.Provider value={context}>\n      {children}\n    </BhdInternalContext.Provider>\n  );\n};\n","export const DEFAULT_BASE_URL = \"https://bhd.matteolutz.de\";\n","import { BhdContextType, useBhdInternalContext } from \"./context\";\n\nexport { type BhdContextType } from \"./context\";\n\nexport const useBhdContext = (): BhdContextType => {\n  const internalContext = useBhdInternalContext();\n\n  return {\n    accessToken: internalContext.accessToken,\n    blueprintLut: internalContext.blueprintLut,\n    getContentBlock: internalContext.getContentBlock,\n    getAssetUrl: internalContext.getAssetUrl,\n  };\n};\n"],"mappings":"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","names":["forwardRef","jsx","jsxs","forwardRef","contentBlock","useState","jsx","useState"]}